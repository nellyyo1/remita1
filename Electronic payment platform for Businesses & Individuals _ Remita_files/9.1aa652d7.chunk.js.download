(this["webpackJsonpebanqo-messenger"]=this["webpackJsonpebanqo-messenger"]||[]).push([[9],{104:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l}));var a=n(3),i=n(5),c=n(85),r=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i,r,o,s=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:1,r=s.length>3&&void 0!==s[3]?s[3]:20,e.prev=2,e.next=5,c.c.webchat.getWebChatChatSessions(t,n,i,r);case 5:return o=e.sent,e.abrupt("return","success"===o.data.status?o.data.data:[]);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}(),o=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n,i){var r,o,s,u=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>3&&void 0!==u[3]?u[3]:1,o=u.length>4&&void 0!==u[4]?u[4]:40,e.prev=2,e.next=5,c.c.webchat.getWebChatInitialUserMessageHistory(t,n,i,r,o);case 5:s=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",[]);case 11:return e.abrupt("return",s?s.data:[]);case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n,a){return e.apply(this,arguments)}}(),s=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.c.webchat.getClientCode(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return","404");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,i,r=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"bot",r.length>2&&void 0!==r[2]?r[2]:1,r.length>3&&void 0!==r[3]?r[3]:40,e.prev=3,e.next=6,c.c.webchat.getWebChatChatSessionMessages(t,n);case 6:return i=e.sent,e.abrupt("return","success"===i.data.status&&i.data.data);case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.c.webchat.sendChatToEmail(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},107:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return r}));var a={},i=function(){var e=0;return function(){return e+=1}}();function c(e,t){var n=i();return a[e]||(a[e]={}),a[e][n]=t,{unsubscribe:function(){delete a[e][n],0===Object.keys(a[e]).length&&delete a[e]}}}function r(e,t){a[e]&&Object.keys(a[e]).forEach((function(n){return a[e][n](t)}))}},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(708),i=n(107),c={isConnected:!1,socket:null,interval:null,connect:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"new",n=this;this.socket&&(window.EBQ_WEBCHAT_SOCKET&&window.EBQ_WEBCHAT_SOCKET.destroy(),this.socket.destroy(),this.socket.close(),delete this.socket,window.EBQ_WEBCHAT_SOCKET=null,this.socket=null);return this.socket=a.a.connect("".concat("https://webchat-be.ebanqo.io"),{transports:["websocket"],rejectUnauthorized:!1}),this.socket.on("connect",(function(){e.isConnected=!0,window.EBQ_WEBCHAT_SOCKET=e.socket,console.log("Socket Connected!",e.socket),"new"===t?Object(i.a)("newSocketConnected",e.socket):Object(i.a)("exisitingSocketConnected",e.socket)})),this.socket.on("disconnect",(function(t){e.isConnected=!1,Object(i.a)("socketDisconnected",e.socket),console.log("Socket Disconnected",t),e.interval=window.setInterval((function(){if(e.isConnected)return clearInterval(e.interval),void(n.interval=null);n.connect("existing")}),5e3)})),this.socket.on("connect_error",(function(e){console.log("SOCKET_CONNECT_ERROR",e)})),this.socket}}},180:function(e,t,n){"use strict";t.a=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(n){return n instanceof DOMException&&(22===n.code||1014===n.code||"QuotaExceededError"===n.name||"NS_ERROR_DOM_QUOTA_REACHED"===n.name)&&e&&0!==e.length}}},181:function(e,t,n){"use strict";function a(e){return e.split(/[?#]/)[0]}n.d(t,"a",(function(){return a}))},728:function(e,t,n){"use strict";n.r(t);var a=n(3),i=n(5),c=n(8),r=n(61),o=n(4),s=n(0),u=n.n(s),l=n(2),d=n(165),f=n.n(d),b=n(326),p=n(104),v=n(717),h=n(718),m=n(719),O=n(85),g=function(){Object.prototype.toString;var e=function(e){return e},t=function(e){var t=null!=e&&"object"===typeof e&&this.prop in e;return this.parser(t?e[this.prop]:e)};return function(n,a){return n instanceof Array&&n.length?("[object Object]"!==Object.prototype.toString.call(a)&&(a={}),"function"!==typeof a.parser&&(a.parser=e),a.desc=a.desc?-1:1,n.sort((function(e,n){return e=t.call(a,e),n=t.call(a,n),a.desc*(e<n?-1:+(e>n))}))):[]}}(),j=function(e){return void 0===e||null===e||"object"===typeof e&&0===Object.keys(e).length||"string"===typeof e&&0===e.trim().length},w=n(107),_=n(176),E=n(350),S=function(e){e&&(O.a.defaults.headers.common.parent="".concat(e),O.b.defaults.headers.common.parent="".concat(e))},y=n(180),k=n(181),M=n.p+"static/media/doc.ef8f3762.svg",C=n.p+"static/media/audio.03c1c260.svg",B=n.p+"static/media/photo.80a54406.svg",T=n(6),A=new b.Howl({src:["/notify.mp3"]}),x=u.a.lazy((function(){return Promise.all([n.e(0),n.e(4),n.e(1),n.e(7)]).then(n.bind(null,729))})),I=u.a.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(8)]).then(n.bind(null,727))})),U=u.a.lazy((function(){return Promise.resolve().then(n.bind(null,27))})),P=u.a.lazy((function(){return n.e(10).then(n.bind(null,732))}));t.default=function(e){var t=e.versionType,n=Object(l.q)().clientCode,u=Object(l.m)(),d=Object(s.useState)(!0),b=Object(o.a)(d,2),D=b[0],W=b[1],N=Object(s.useState)(""),F=Object(o.a)(N,2),H=F[0],Q=F[1],L=Object(s.useState)(""),R=Object(o.a)(L,2),G=R[0],z=R[1],q=Object(s.useState)(!1),K=Object(o.a)(q,2),V=K[0],J=K[1],Y=Object(s.useState)([]),$=Object(o.a)(Y,2),X=$[0],Z=$[1],ee=Object(s.useState)([]),te=Object(o.a)(ee,2),ne=te[0],ae=te[1],ie=Object(s.useState)([]),ce=Object(o.a)(ie,2),re=ce[0],oe=ce[1],se=Object(s.useState)([]),ue=Object(o.a)(se,2),le=ue[0],de=ue[1],fe=Object(s.useState)(null),be=Object(o.a)(fe,2),pe=be[0],ve=be[1],he=Object(s.useState)(null),me=Object(o.a)(he,2),Oe=me[0],ge=me[1],je=Object(s.useState)(!0),we=Object(o.a)(je,2),_e=we[0],Ee=we[1],Se=Object(s.useState)(null),ye=Object(o.a)(Se,2),ke=ye[0],Me=ye[1],Ce=Object(s.useState)(!1),Be=Object(o.a)(Ce,2),Te=Be[0],Ae=Be[1],xe=Object(s.useState)({}),Ie=Object(o.a)(xe,2),Ue=Ie[0],Pe=Ie[1],De=Object(s.useState)([]),We=Object(o.a)(De,2),Ne=We[0],Fe=We[1],He=Object(s.useState)(!1),Qe=Object(o.a)(He,2),Le=Qe[0],Re=Qe[1],Ge=Object(s.useState)(!1),ze=Object(o.a)(Ge,2),qe=ze[0],Ke=ze[1],Ve=Object(s.useState)(""),Je=Object(o.a)(Ve,2),Ye=Je[0],$e=Je[1],Xe=Object(s.useState)(!1),Ze=Object(o.a)(Xe,2),et=Ze[0],tt=Ze[1],nt=Object(s.useState)(!1),at=Object(o.a)(nt,2),it=at[0],ct=at[1],rt=Object(s.useState)(!1),ot=Object(o.a)(rt,2),st=(ot[0],ot[1],Object(s.useState)(!1)),ut=Object(o.a)(st,2),lt=ut[0],dt=ut[1],ft=Object(s.useState)(!1),bt=Object(o.a)(ft,2),pt=bt[0],vt=(bt[1],Object(s.useState)({type:"",status:!1})),ht=Object(o.a)(vt,2),mt=ht[0],Ot=ht[1],gt=Object(s.useState)({}),jt=Object(o.a)(gt,2),wt=jt[0],_t=jt[1],Et=Object(s.useState)({visible:!1,modalData:{}}),St=Object(o.a)(Et,2),yt=St[0],kt=St[1],Mt=Object(s.useState)(!1),Ct=Object(o.a)(Mt,2),Bt=Ct[0],Tt=Ct[1],At=Object(s.useState)(null),xt=Object(o.a)(At,2),It=xt[0],Ut=xt[1],Pt=Object(s.useState)(!1),Dt=Object(o.a)(Pt,2),Wt=Dt[0],Nt=Dt[1],Ft=Object(s.useState)(null),Ht=Object(o.a)(Ft,2),Qt=Ht[0],Lt=Ht[1],Rt=Object(s.useState)(null),Gt=Object(o.a)(Rt,2),zt=Gt[0],qt=Gt[1],Kt=Object(s.useState)(!0),Vt=Object(o.a)(Kt,2),Jt=Vt[0],Yt=Vt[1],$t=Object(s.useState)(!1),Xt=Object(o.a)($t,2),Zt=Xt[0],en=Xt[1],tn=Object(s.useState)(!1),nn=Object(o.a)(tn,2),an=nn[0],cn=nn[1],rn=Object(s.useState)(""),on=Object(o.a)(rn,2),sn=on[0],un=on[1],ln=f.a.parse(u.search),dn=window.location!=window.parent.location?document.referrer:document.location.href;Object(s.useEffect)((function(){var e,t;if(Zt)return Yt(!1);if((null===ln||void 0===ln||!ln.source)&&null!==pe&&void 0!==pe&&null!==(e=pe.security)&&void 0!==e&&e.is_active){if(pe&&null!==pe&&void 0!==pe&&pe.security){var n,a=pn(dn,null===pe||void 0===pe||null===(n=pe.security)||void 0===n?void 0:n.allowed_domains);return a&&Yt(!0),void(!a&&Yt(!1))}if(pe&&(null===pe||void 0===pe||!pe.security))return Yt(!0);Yt(!1)}return null!==ln&&void 0!==ln&&ln.source||null!==pe&&void 0!==pe&&null!==(t=pe.security)&&void 0!==t&&t.is_active?null!==ln&&void 0!==ln&&ln.source?Yt(!0):void 0:Yt(!0)}),[dn,pe,ln,Zt]),Object(s.useEffect)((function(){var e=Object(w.b)("exisitingSocketConnected",(function(e){if(zt){var t=zt.sender_id,n=zt.recipient_id;Oe?Oe.id!==e.id&&!0!==Oe.connected&&(e.emit("send",{type:"connection",recipient_id:n,sender_id:t,token:(null===ln||void 0===ln?void 0:ln.token)||void 0}),ge(e),Ae(!0)):(ge(e),Ae(!0),e.emit("send",{type:"connection",recipient_id:n,sender_id:t,token:(null===ln||void 0===ln?void 0:ln.token)||void 0}))}})),t=Object(w.b)("socketDisconnected",(function(e){Ae((function(e){return!1}))})),n=Object(w.b)("newSocketConnected",(function(e){Ae((function(e){return!0})),ge((function(t){return e}))})),a=Object(w.b)("block",(function(e){Yt(!1)}));return function(){n.unsubscribe(),t.unsubscribe(),e.unsubscribe(),a.unsubscribe()}}),[zt,Oe,ln]),Object(s.useEffect)((function(){null!==zt&&void 0!==zt&&zt.recipient_id&&Oe.emit("send",{type:"connection",recipient_id:null===zt||void 0===zt?void 0:zt.recipient_id,sender_id:null===zt||void 0===zt?void 0:zt.sender_id,token:(null===ln||void 0===ln?void 0:ln.token)||void 0})}),[null===Oe||void 0===Oe?void 0:Oe.connected,zt]),Object(s.useEffect)((function(){Q(n),window.parent.postMessage("webchat_loaded",dn)}),[]),Object(s.useEffect)((function(){var e;if(ln.version&&delete ln.version,pe&&Oe){var t,n;if(Object(y.a)())e=JSON.parse((null===(t=localStorage)||void 0===t?void 0:t.getItem("".concat(pe.agent_code,"_webchat_user_info")))||"null"),qt(e);if(e&&e.sender_id)return Me((function(t){return Object(r.a)(Object(r.a)({},t),e)})),window.EBQ_WEBCHAT_USER_INFO=e,e.rememberMe&&J((function(e){return!1})),Oe.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===ln||void 0===ln?void 0:ln.token)||void 0}),null!==ln&&void 0!==ln&&null!==(n=ln.source)&&void 0!==n&&n.includes("appchat")?void vn(ln):void hn(e.sender_id,e.recipient_id,null===ln||void 0===ln?void 0:ln.source);pe&&pe.show_reg_form?j(ln)?jn():vn(ln):j(ln)?vn(ln):vn()}}),[pe]),Object(s.useEffect)((function(){H&&(ge(_.a.connect()),H&&bn(H))}),[H]),Object(s.useEffect)((function(){var e;(null===Oe||void 0===Oe?void 0:Oe.on)&&(null===Oe||void 0===Oe||null===(e=Oe.off("receive",fn))||void 0===e||e.on("receive",fn))}),[Oe]),Object(s.useEffect)((function(){var e=Object(w.b)("userMessage",(function(e){tt((function(e){return!1})),Ae((function(e){return!0}));var t=window.EBQ_WEBCHAT_USER_INFO,n=t.sender_id,a=t.recipient_id;if(null===Oe||void 0===Oe||Oe.emit("send",{type:"ack",sender_id:n,recipient_id:a,id:e.data.id}),e&&"incoming"===e.data.type){an&&A.play(),window.parent.postMessage("user_message",dn);var i=le.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{quick_replies:[],buttons:[]})})),o=ne.filter((function(t){return t.timestamp!==e.data.timestamp}));ae((function(e){return o})),de((function(t){return[].concat(Object(c.a)(i),[Object(r.a)(Object(r.a)({},e.data),{},{sender:"bot"})])})),Object(w.a)("scroll-message-trail",{})}if(e&&"outgoing"===e.data.type){var s=ne.filter((function(t){return t.timestamp!==e.data.timestamp})),u=re.filter((function(t){return t.timestamp!==e.data.timestamp}));ae((function(e){return s})),de((function(t){var n=Object(r.a)(Object(r.a)({},e.data),{},{date:(new Date).toISOString(),sender:"user",quick_replies:[]});return n.attachments&&n.attachments.length?[].concat(Object(c.a)(t),[Object(r.a)(Object(r.a)({},n),{},{msg_type:"attachment",allDelivered:!0})]):[].concat(Object(c.a)(t),[n])})),oe((function(e){return u}))}})),t=Object(w.b)("typing",(function(e){tt((function(e){return!0})),Object(w.a)("scroll-message-trail",{}),Ee((function(e){return!1}))}));return function(){e.unsubscribe(),t.unsubscribe()}}),[le,ne,re,Oe,an]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_SENT_MESSAGES=ne}),[ne]),Object(s.useEffect)((function(){Object(w.a)("scroll-message-trail",{})}),[null===re||void 0===re?void 0:re.length]),Object(s.useEffect)((function(){var e=Object(w.b)("minimize_widget",(function(){cn(!0)}));return function(){e.unsubscribe()}}),[]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_PENDING_MESSAGES=re}),[re]),Object(s.useEffect)((function(){window.EBQ_WEBCHAT_DELIVERED_MESSAGES=le,Ee((function(e){return!1}))}),[le]),Object(s.useEffect)((function(){window.parent.postMessage("iframe_message",dn);var e=function(e){var t,n,a,i,c,r,o,s;(e.origin&&S(e.origin),null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.configs&&null!==e&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&null!==(a=n.configs)&&void 0!==a&&a.showChannelButtonsOnSignupForm)&&Lt(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.configs);null!==e&&void 0!==e&&null!==(i=e.data)&&void 0!==i&&i.websiteURL?un(null===e||void 0===e||null===(c=e.data)||void 0===c?void 0:c.websiteURL):un(dn),"maximize_widget"===(null===(r=e.data)||void 0===r?void 0:r.message)&&cn(!1),"minimize_widget"===(null===(o=e.data)||void 0===o?void 0:o.message)&&cn(!0)},t=setTimeout((function(){Q(n)}),1e3);return window.addEventListener("message",e,!1),function(){window.removeEventListener("message",e),clearTimeout(t)}}),[]);var fn=function(e){Object(w.a)(null===e||void 0===e?void 0:e.type,e)},bn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(n){var i,c;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.b)(n);case 2:if("404"!==(i=e.sent)){e.next=7;break}return Ot({type:"Not Found",status:!0}),W(!1),e.abrupt("return");case 7:if(window.parent.postMessage({type:"webchat_client_config",configs:null===i||void 0===i?void 0:i.data},dn),"v2"!==t){e.next=14;break}if(null!==i.data.options){e.next=13;break}return Ot({type:"Does not exist on V2",status:!0}),W(!1),e.abrupt("return");case 13:_t(null===(c=i.data.options)||void 0===c?void 0:c.platforms);case 14:window.EBQ_WEBCHAT_CLIENT_INFO=i.data,ve((function(e){return i.data})),W(!1);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pn=function(e,t){var n=new URL(e).hostname.toLowerCase();return t.some((function(e){var t=e.toLowerCase();if("*"===t)return!0;var a=n===t,i=t.startsWith("*.")&&n.endsWith(t.slice(2));return a||i}))},vn=function(e){var t={fullname:null,email:null,recipient_id:pe.agent_code,status:"new",timestamp:(new Date).getTime(),os:null===e||void 0===e?void 0:e.os,source:null===e||void 0===e?void 0:e.source,device_token:null===e||void 0===e?void 0:e.device_token,form:Object(r.a)(Object(r.a)({},e),{},{os:void 0,source:void 0,device_token:void 0}),page_url:Object(k.a)(sn)};O.c.webchat.initialUserRegistration(t).then((function(n){if(Ee(!1),"success"===n.data.status){var a=Object(r.a)(Object(r.a)(Object(r.a)({},t),n.data.data),{},{rememberMe:"appchat"===(null===e||void 0===e?void 0:e.source)});qn(a)}})).catch((function(e){en(!0),Ee(!1)}))},hn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i,o,s,u=arguments;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>2&&void 0!==u[2]?u[2]:"webchat",Ee(!0),e.next=4,Object(p.e)(t,n,i);case 4:o=e.sent,Ee((function(e){return!1})),s=(s=o?o.data&&Array.isArray(o.data.data)&&o.data.data.map((function(e){var t=Object(r.a)(Object(r.a)({},e),{},{icon:pe.icon,history:!0,allDelivered:!0,attachments:"string"===typeof e.attachments?JSON.parse(e.attachments):e.attachments});return e.attachments&&e.attachments.length?Object(r.a)(Object(r.a)({},t),{},{msg_type:"attachment"}):t})):[])&&s.length?s:[],de((function(e){return g([].concat(Object(c.a)(e),Object(c.a)(s)),{prop:"date",desc:!1})}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),mn=function(){Object(y.a)()&&localStorage.removeItem("".concat(pe.agent_code,"_webchat_user_info")),J((function(e){return!0})),Z((function(e){return[]})),ae((function(e){return[]})),oe((function(e){return[]})),de((function(e){return[]})),window.EBQ_WEBCHAT_SOCKET&&window.EBQ_WEBCHAT_SOCKET.close()},On=function(){Tt(!0),En(ke.sender_id,ke.recipient_id).then((function(e){return Tt(!1)}))},gn=function(e){Ut(e),Nt(!0)},jn=function(){J((function(e){return!e}))},wn=function(e){Fe((function(t){return[].concat(Object(c.a)(t),[e])}))},_n=function(){Ke(!1),Re(!1),Fe([]),Un({})},En=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t,n){var i;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ee((function(e){return!0})),e.next=3,Object(p.d)(t,n);case 3:i=e.sent,Z((function(e){return i&&Array.isArray(i)?Object(c.a)(i):e})),Ee((function(e){return!1}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Sn=function(e,t){var n=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(n){var a=n;if(a.attachments){var i=a.attachments.map((function(n){return e===n.name?Object(r.a)(Object(r.a)({},n),{},{progress:t}):n}));a.attachments=i}return a}));oe((function(e){return n}))},yn=function(e,t){var n=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(n){var a=n;if(a.attachments){var i=a.attachments.map((function(n){return e===n.name?Object(r.a)(Object(r.a)({},n),{},{error:t}):n}));a.attachments=i}return a}));oe((function(e){return n}))},kn=function(e){var t=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.filter((function(t){return e.timestamp===t.timestamp}))[0];(1===t.attachments.length&&Tn(t),t.attachments.length>1)&&(t.attachments.filter((function(e){return 100===e.progress})).length===t.attachments.length&&Tn(t))},Mn=function(){Nt(!1),Ut(null)},Cn=function(e,t){var n=e.name.split(".")[e.name.split(".").length-1];return t.check.test("/".concat(n))};function Bn(e){e.forEach((function(e,t){var n=new FileReader;n.onload=function(e){return function(){var c=Object(i.a)(Object(a.a)().mark((function i(c){var o,s;return Object(a.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o={url:n.result,type:e.type.split("/")[0],name:e.name,caption:0===t&&Ye?Ye:null,img_id:"".concat(e.name).concat((new Date).getTime())},!e.type.includes("video")){a.next=9;break}return a.next=4,Object(E.a)(e,{interval:1,start:2,end:2});case 4:return a.sent,s=Object(r.a)({},o),0===t&&Un(s),wn(s),a.abrupt("return");case 9:0===t&&Un(o),wn(o);case 11:case"end":return a.stop()}}),i)})));return function(e){return c.apply(this,arguments)}}()}(e),$e(""),n.readAsDataURL(e)}))}var Tn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.attachments.map((function(e){var t=e;return delete t.progress,delete t.img_id,t.thumbnail&&delete t.thumbnail,t})),e.next=3,O.c.webchat.sendMessage(Object(r.a)(Object(r.a)({},t),{},{attachments:n,page_url:Object(k.a)(sn)})).then((function(e){"success"===e.data.status&&(window.EBQ_WEBCHAT_DELIVERED_MESSAGES.filter((function(t){return t.timestamp===e.data.data.timestamp})).length||ae((function(t){return[].concat(Object(c.a)(window.EBQ_WEBCHAT_SENT_MESSAGES),[Object(r.a)(Object(r.a)({},e.data.data),{},{sender:"user",msg_type:"attachment",allSent:!0})])})),oe((function(e){return e.filter((function(e){return e.timestamp!==t.timestamp}))})))}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),An=Object(s.useState)({}),xn=Object(o.a)(An,2),In=xn[0],Un=xn[1],Pn=[{name:"image",desc:"Photo/Video",listType:"picture-card",accept:"image/png, image/jpeg, image/jpg, video/*",icon:v.a,check:/(\.|\/)(png|jpeg|jpg|3gp|mp4|webm)$/i,svg:B},{name:"audio",desc:"Audio",accept:"audio/*, application/ogg, application/x-flac",icon:h.a,check:/(\.|\/)(mpeg|wav|ogg|mp3|m4a|aac|flac|wma|mp4|midi)$/i,svg:C},{name:"application",desc:"Document",accept:"application/msword, application/vnd.ms-excel, application/vnd.ms-powerpoint, text/plain, application/pdf, .csv, .xls, .xlsx, .doc, .docx",check:/(\.|\/)(doc|docx|xls|xlsx|ppt|pptx|txt|pdf|csv*)$/i,icon:m.a,svg:M}],Dn=function(){Ke((function(e){return!e}))},Wn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,i,o;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(Ye||t)&&(n={text:t||Ye,sender_id:null===ke||void 0===ke?void 0:ke.sender_id,recipient_id:null===pe||void 0===pe?void 0:pe.agent_code,timestamp:(new Date).getTime(),page_url:Object(k.a)(sn)},O.c.webchat.sendMessage(n).then((function(e){"success"===e.data.status&&(window.EBQ_WEBCHAT_DELIVERED_MESSAGES.filter((function(t){return t.timestamp===e.data.data.timestamp})).length||ae((function(t){return[].concat(Object(c.a)(window.EBQ_WEBCHAT_SENT_MESSAGES),[Object(r.a)(Object(r.a)({},e.data.data),{},{sender:"user"})])})),oe((function(e){return e.filter((function(e){return e.timestamp!==n.timestamp}))})))})),i=window.EBQ_WEBCHAT_DELIVERED_MESSAGES.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[],quick_replies:[]})})),de((function(e){return i})),$e(""),o=re.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[],quick_replies:[]})})),oe((function(e){return[].concat(Object(c.a)(o),[Object(r.a)(Object(r.a)({},n),{},{date:(new Date).toISOString(),sender:"user"})])})),Object(w.a)("scroll-message-trail",{fromSendMessage:!0}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nn=function(e){$e(e.target.value)},Fn=function(e){var t=e.colons;$e((function(e){return Ye+t})),dt(!1)},Hn=function(){dt((function(e){return!e}))},Qn=function(){dt(!1)},Ln=function(){Re((function(e){return!0}))},Rn=function(e){if(e.name===In.name&&e.url===In.url)if(Ne.length<2)Fe([]);else{var t=Ne.findIndex((function(t){return t.url===e.url&&t.name===e.name}));Un(Ne[t-1]||Ne[t+1])}Fe((function(t){return t.filter((function(t){return t.name!==e.name||t.url!==e.url}))}))},Gn=function(){var e=Object(i.a)(Object(a.a)().mark((function e(t){var n,o,s;return Object(a.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(t||Ne).map((function(e,t){var n=Object(r.a)(Object(r.a)({},e),{},{type:e.type,caption:e.caption||null});return["image","audio","video"].includes(e.type)||(n.type="file"),n})),o={attachments:n,sender_id:ke.sender_id,recipient_id:pe.agent_code,msg_type:"attachment",sender:"user",text:null,timestamp:(new Date).getTime()},oe((function(e){return[].concat(Object(c.a)(e),[o])})),s=[],n.forEach((function(e){s.push(O.c.webchat.uploadFile({filename:e.name,data_url:e.url,img_id:e.img_id},Sn).catch((function(t){var n,a,i,c;422===(null===t||void 0===t||null===(n=t.response)||void 0===n?void 0:n.status)&&yn(null===e||void 0===e?void 0:e.name,null===t||void 0===t||null===(a=t.response)||void 0===a||null===(i=a.data)||void 0===i||null===(c=i.data)||void 0===c?void 0:c.message)})))})),Promise.all(s).then((function(e){e.forEach(function(){var t=Object(i.a)(Object(a.a)().mark((function t(n){var i;return Object(a.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=window.EBQ_WEBCHAT_PENDING_MESSAGES&&window.EBQ_WEBCHAT_PENDING_MESSAGES.map((function(t){var n=t;if(n.attachments){var a=n.attachments.map((function(t){var n,a=e.find((function(e){var n;return(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data.img_id)===(null===t||void 0===t?void 0:t.img_id)}));return a?Object(r.a)(Object(r.a)({},t),{},{url:null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.data.url,data_url:a.config.data.data_url}):t}));n.attachments=a}return n})),oe((function(e){return[].concat(Object(c.a)(e),[i])})),kn(o);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})),_n();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),zn=function(e,t){var n=Ne,a=n.findIndex((function(t){return t.name===e.name&&t.url===e.url}));n[a]&&(n[a]=Object(r.a)(Object(r.a)({},n[a]),{},{caption:t}),Fe(n))},qn=function(e){var t,n,a,i;if(Me(e),hn(e.sender_id,e.recipient_id,null===e||void 0===e?void 0:e.source),null===(t=window.EBQ_WEBCHAT_SOCKET)||void 0===t||!t.connected){var o=_.a.connect();o.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===ln||void 0===ln?void 0:ln.token)||void 0}),ge(o)}(null!==(n=window.EBQ_WEBCHAT_SOCKET)&&void 0!==n&&n.connected&&window.EBQ_WEBCHAT_SOCKET.emit("send",{type:"connection",recipient_id:e.recipient_id,sender_id:e.sender_id,token:(null===ln||void 0===ln?void 0:ln.token)||void 0}),qt(e),window.EBQ_WEBCHAT_USER_INFO=e,de((function(t){return[].concat(Object(c.a)(t),[Object(r.a)(Object(r.a)({},e),{},{sender:"bot"})])})),Object(y.a)())&&(e.rememberMe&&(null===(a=localStorage)||void 0===a||a.setItem("".concat(pe.agent_code,"_webchat_user_info"),JSON.stringify(e))),!pe.show_reg_form&&(null===(i=localStorage)||void 0===i||i.setItem("".concat(pe.agent_code,"_webchat_user_info"),JSON.stringify(Object(r.a)(Object(r.a)({},e),{},{rememberMe:!0})))))},Kn=function(){var e=le.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[]})}));de((function(t){return e}))},Vn=function(e){if(e){var t=le.map((function(e){return Object(r.a)(Object(r.a)({},e),{},{buttons:[]})}));return de((function(e){return t})),void kt({visible:!yt.visible,modalData:e})}kt({visible:!yt.visible,modalData:{}})},Jn=function(e){Wn(e)},Yn=function(e,t,n,a){if("web_url"===n)return Vn({url:a,title:e});Wn(e)},$n=function(e,n){var a=Array.from(e.target.files);Pe(n);var i=a.filter((function(e){return!Cn(e,n)}));a.filter((function(e){return e.size>5242880})).length&&alert("You selected a file/files larger than 5MB, and any file larger than 5MB will be automatically filtered out of the selected files.");var c=a.filter((function(e){return Cn(e,n)&&!(e.size>5242880)}));i.length&&alert("You selected file(s) with incorrect format, and any file(s) with incorrect format will be automatically filtered out of the selected files."),c.length&&Bn(c),"v1"===t&&c.length&&Ln()};return Object(T.jsxs)(T.Fragment,{children:[!(D||!Jt)&&Object(T.jsx)(T.Fragment,{children:"v1"===t?Object(T.jsx)(I,{setIsWebchatAccessible:Yt,showSignUpForm:V,chatSessions:X,sentMessages:ne,pendingMessages:re,deliveredMessages:le,versionType:t,clientInfo:pe,setSocket:ge,socket:Oe,handleUserLogOut:mn,setIsMessageLoading:Ee,isMessageLoading:_e,isLoadingPreviousSessions:Bt,userInfo:ke,fetchUserPreviewSessions:On,openUploadingMediaFilesPreviewModal:gn,isSocketConnected:Te,toggleSignUpForm:jn,handledFileUpload:$n,handleAddMediaToPreviewModal:wn,selectedFileType:Ue,setMediaPreviewInfo:Fe,mediaPreviewInfo:Ne,setActiveMedia:Un,activeMedia:In,showMediaUploadModal:Le,setShowMediaUploadModal:Re,setShowUploadButtons:Ke,showUploadButtons:qe,fileTypes:Pn,supportActive:pt,toggleUploadButtonsContainer:Dn,handleSendMessageToBot:Wn,messageTextInputValue:Ye,handleTextInputValueChange:Nn,addEmoji:Fn,showEmojiPicker:lt,toggleEmojiPicker:Hn,closeEmojiPicker:Qn,openMediaPreviewModal:Ln,handleRemoveMediaFromPreviewModal:Rn,sendMediaFiles:Gn,onCaptionInputChange:zn,showIsTypingIndicator:et,handleAfterNewUserRegistration:qn,handleLinkButtonForMobile:Kn,toggleLinkModal:Vn,linkModal:yt,handleQuickReplyAction:Jn,handleCarouselButton:Yn,showUploadingMediaFilesPreviewModal:Wt,showMenu:it,setShowMenu:ct,handldeFileUpload:function(e,t){var n=Array.from(e.target.files);Pe(t);var a=n.filter((function(e){return!Cn(e,t)}));n.filter((function(e){return e.size>5242880})).length&&alert("You selected a file/files larger than 5MB, and any file larger than 5MB will be automatically filtered out of the selected files.");var i=n.filter((function(e){return Cn(e,t)&&!(e.size>5242880)}));a.length&&alert("You selected file(s) with incorrect format, and any file(s) with incorrect format will be automatically filtered out of the selected files."),i.length&&Bn(i),i.length&&Ln()},closeMediaPreviewModal:_n,uploadingMediaFilesPreview:It,closeUploadingMediaFilesPreviewModal:Mn,v1WidgetConfigs:Qt,userPageUrl:sn}):Object(T.jsx)(x,{setIsWebchatAccessible:Yt,setShowSignUpForm:J,showSignUpForm:V,chatSessions:X,sentMessages:ne,pendingMessages:re,deliveredMessages:le,versionType:t,clientInfo:pe,setSocket:ge,socket:Oe,handleUserLogOut:mn,setIsMessageLoading:Ee,isMessageLoading:_e,isLoadingPreviousSessions:Bt,userInfo:ke,fetchUserPreviewSessions:On,openUploadingMediaFilesPreviewModal:gn,isSocketConnected:Te,setIsSocketConnected:Ae,toggleSignUpForm:jn,setScreenHistory:z,screenHistory:G,handledFileUpload:$n,handleAddMediaToPreviewModal:wn,mediaPreviewInfo:Ne,setActiveMedia:Un,showMediaUploadModal:Le,setShowUploadButtons:Ke,showUploadButtons:qe,fileTypes:Pn,supportActive:pt,isLoading:D,activeChannelList:wt,uploadingMediaFilesPreview:It,closeUploadingMediaFilesPreviewModal:Mn,showUploadingMediaFilesPreviewModal:Wt,toggleUploadButtonsContainer:Dn,handleSendMessageToBot:Wn,messageTextInputValue:Ye,handleTextInputValueChange:Nn,addEmoji:Fn,showEmojiPicker:lt,toggleEmojiPicker:Hn,closeEmojiPicker:Qn,openMediaPreviewModal:Ln,handleRemoveMediaFromPreviewModal:Rn,sendMediaFiles:Gn,onCaptionInputChange:zn,showIsTypingIndicator:et,handleAfterNewUserRegistration:qn,handleLinkButtonForMobile:Kn,toggleLinkModal:Vn,linkModal:yt,handleQuickReplyAction:Jn,handleCarouselButton:Yn,notFound:mt,userPageUrl:sn})}),!D&&!Jt&&Object(T.jsx)(P,{}),D&&Object(T.jsx)(U,{})]})}},85:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return f}));var a=n(327),i=n.n(a),c=n(345),r=n(12),o=n(11),s=function(){function e(t){Object(r.a)(this,e),this.client=void 0,this.client=t}return Object(o.a)(e,[{key:"getWebChatInitialUserMessageHistory",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40;return this.client.get("/message/chat/".concat(e,"/").concat(t,"/?page=").concat(a,"&page_size=").concat(i,"&source=").concat(n))}},{key:"getWebChatChatSessions",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40;return this.client.get("/message/history/".concat(e,"/").concat(t,"/?page=").concat(n,"&page_size=").concat(a))}},{key:"getWebChatChatSessionMessages",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40;return this.client.get("/message/history/session/".concat(e,"/").concat(t,"/?page=").concat(n,"&page_size=").concat(a))}},{key:"getClientCode",value:function(e){return this.client.get("/config/".concat(e))}},{key:"initialUserRegistration",value:function(e){return this.client.post("/connect",e)}},{key:"sendMessage",value:function(e){return this.client.post("/message",e)}},{key:"uploadFile",value:function(e,t){var n={onUploadProgress:function(n){var a=Math.round(100*n.loaded/n.total);t(e.filename,a)}};return this.client.post("/attachment/upload",e,n)}},{key:"sendChatToEmail",value:function(e){return this.client.post("/chathistory/email",e)}}]),e}(),u=s,l=function(){function e(t){Object(r.a)(this,e),this.client=void 0,this.client=t}return Object(o.a)(e,[{key:"getUserLocation",value:function(){return this.client.get("/bigfoot/api/location?require_city=true")}}]),e}(),d=i.a.create({baseURL:"https://webchat-be.ebanqo.io"}),f=i.a.create({baseURL:"https://ost9cv8wr3.execute-api.us-east-2.amazonaws.com/prod"}),b={webchat:new u(d),userLocation:new l(f)};Object(c.a)(d,{retries:5,retryCondition:c.a.isNetworkError,retryDelay:c.a.exponentialDelay}),Object(c.a)(f,{retries:5,retryCondition:c.a.isNetworkError,retryDelay:c.a.exponentialDelay});t.c=b}}]);
//# sourceMappingURL=9.1aa652d7.chunk.js.map